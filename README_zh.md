# é¡¹ç›®åŠŸèƒ½ç®€ä»‹ï¼šå®æ—¶äº¤æ˜“æ¬ºè¯ˆæ£€æµ‹ç³»ç»Ÿ

è¯¥ç³»ç»Ÿæ—¨åœ¨å¯¹å®æ—¶äº¤æ˜“è¿›è¡Œæ™ºèƒ½æ¬ºè¯ˆè¯†åˆ«ä¸å“åº”ï¼Œä¿éšœèµ„é‡‘å®‰å…¨ä¸ä¸šåŠ¡åˆè§„ã€‚æ ¸å¿ƒåŠŸèƒ½æ¨¡å—åŒ…æ‹¬ï¼š

## æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

| åŠŸèƒ½æ¨¡å—         | æè¿°                                                                 |
|------------------|----------------------------------------------------------------------|
| **æ£€æµ‹è§„åˆ™è®¾ç½®** | æ”¯æŒçµæ´»é…ç½®å¤šç§äº¤æ˜“é£æ§è§„åˆ™ï¼ˆå¦‚é‡‘é¢é˜ˆå€¼ã€é»‘åå•ã€äº¤æ˜“æ—¶æ®µç­‰ï¼‰                  |
| **é»‘åå•åŠŸèƒ½**   | æä¾›é»‘åå•æ·»åŠ ã€æŸ¥è¯¢ã€ç®¡ç†åŠŸèƒ½ï¼Œç”¨äºæ‹¦æˆªé«˜é£é™©è´¦å·                                   |
| **äº¤æ˜“é€šçŸ¥æŸ¥çœ‹** | è®°å½•è¢«æ‹¦æˆª/å‘Šè­¦çš„äº¤æ˜“ä¿¡æ¯ï¼Œæ”¯æŒæŒ‰è´¦å·ã€æ—¶é—´ã€åŸå› ç­‰ç»´åº¦æŸ¥è¯¢ä¸åˆ†æ                         |
| **é€šçŸ¥ç»´æŠ¤**     | æ”¯æŒé€šçŸ¥å‘é€é…ç½®ï¼ˆå¦‚ï¼šé‚®ç®±ã€Webhookã€çŸ­ä¿¡é€šé“ï¼‰ï¼Œå¹¶ç»´æŠ¤é€šçŸ¥å‘é€æ—¥å¿—ä¸çŠ¶æ€                      |

## ç›¸å…³è®¾è®¡æ–‡æ¡£

| åºå· | æ–‡æ¡£åç§°         | æ–‡ä»¶è·¯å¾„                                                                       | æè¿°                 |
|----|--------------|----------------------------------------------------------------------------|----------------------|
| 1  | éƒ¨ç½²æ–‡æ¡£         | [deploy-detail.md](docs/deploy-detail.md)                                  | ç³»ç»Ÿéƒ¨ç½²æ–¹å¼ä¸ç¯å¢ƒé…ç½®è¯´æ˜ |
| 2  | æµ‹è¯•æ–‡æ¡£         | [test-detail.md](docs/test-detail.md)                                      | åŠŸèƒ½æµ‹è¯•åŠæ¥å£éªŒè¯è¯´æ˜ |
| 3  | jemteræµ‹è¯•æ–‡æ¡£   | [test-detail.md](docs/fraud_api_benchmark.md)                              | jemteræµ‹è¯•æ–‡æ¡£  |
| 4  | ç³»ç»Ÿè®¾è®¡æ–‡æ¡£md     | [fraud-design-detail.md](docs/fraud-design-detail.md)                      | æ¶æ„è®¾è®¡ä¸åŠŸèƒ½æ¨¡å—è¯´æ˜ |
| 5  | ç³»ç»Ÿè®¾è®¡æ–‡æ¡£pdf    | [design-detail.pdf](docs/design-detail.pdf)                                | Postman æ¥å£æµ‹è¯•é›†åˆ |
| 6  | æ¥å£æ–‡æ¡£ï¼ˆPostmanï¼‰ | [fraud-local.postman_collection.json](docs/fraud-local.postman_collection.json) | Postman æ¥å£æµ‹è¯•é›†åˆ |
| 7  | å•å…ƒæµ‹è¯•æŠ¥å‘Š       | [index.html](./htmlReport/index.html)                                        | å•å…ƒæµ‹è¯•æŠ¥å‘Šé›†åˆ |
| 8  | åŠŸèƒ½ä¼˜åŒ–è€ƒé‡è®¾æƒ³     | [extend-design.md](docs/extend-design.md)                                  | åŠŸèƒ½ä¼˜åŒ–è€ƒé‡è®¾æƒ³ |


## ğŸ¬é¡¹ç›®é¢„è§ˆè§†é¢‘

è¯¥è§†é¢‘å±•ç¤ºäº†ç³»ç»Ÿä¸»è¦åŠŸèƒ½ä¸äº¤äº’æµç¨‹ã€‚å»ºè®®ä½¿ç”¨ Chrome æˆ– Firefox æ’­æ”¾ã€‚

[<video width="640" height="360" controls>
  <source src="./preview-fraud-new.mp4" type="video/mp4">
  your browser do not support videoã€‚
</video>
](https://github.com/user-attachments/assets/4256aa4a-5184-4158-9e63-7b8d9f8cd447)

## æµ‹è¯•ç¯å¢ƒåœ°å€
> **ç¯å¢ƒåœ°å€**ï¼š[http://121.43.35.48:8090/](http://121.43.35.48:8090/)

## åŠŸèƒ½æˆªå›¾
1. æ£€æµ‹è§„åˆ™è®¾ç½®![img.png](docs/img/fraud-front-rule-setting.png)
2. é»‘åå•åŠŸèƒ½![img.png](docs/img/fraud-front-blacklist-mng.png)
3. äº¤æ˜“æ£€æµ‹åŠŸèƒ½![img.png](docs/img/fraud-check-test-1.png)![img.png](docs/img/fraud-tx-check-result.png)

# äºŒ. æœ¬åœ°å¼€å‘ä¸éƒ¨ç½²æµ‹è¯•

## 1. å·¥ç¨‹ä»‹ç»ä¸è¯´æ˜

æ•´ä½“å·¥ç¨‹æºç åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªç›®å½•å’Œè¯´æ˜ï¼š

### 1.1 deploy æ–‡ä»¶å¤¹
å­˜æ”¾éƒ¨ç½²æ‰€éœ€çš„ Kubernetes é›†ç¾¤ YAML æ–‡ä»¶ï¼š
- `fraud-deploy.yaml`: ç”¨äºéƒ¨ç½² fraud åº”ç”¨ï¼ŒåŒ…æ‹¬ serviceã€configmap ç­‰ã€‚
- `mysql-deploy.yaml`ã€`redis-deploy.yaml`ã€`rockermq-deploy.yaml`: éƒ¨ç½²è¾…åŠ©ç»„ä»¶ï¼Œå¦‚å·²æœ‰ç¯å¢ƒå¯æŒ‰éœ€ä¿®æ”¹ã€‚

### 1.2 dockers æ–‡ä»¶å¤¹
å­˜æ”¾æ„å»º fraud é•œåƒæ‰€éœ€çš„ `Dockerfile` æ–‡ä»¶ã€‚

### 1.3 docs æ–‡ä»¶å¤¹
åŒ…å«æ¶æ„ã€æˆªå›¾ã€è¯´æ˜æ–‡æ¡£ç­‰ç›¸å…³è®¾è®¡æ–‡æ¡£ã€‚

### 1.4 libs æ–‡ä»¶å¤¹
æœ¬åœ°è¿è¡Œæ‰€éœ€ä¾èµ–åŒ…ã€‚åœ¨æœ¬åœ°è¿è¡Œå‰éœ€å°† `sct.zip` è§£å‹è‡³ Maven æœ¬åœ°ä»“åº“ï¼Œä¾‹å¦‚ï¼š

```
${maven}/m2/repository/com
```
![img.png](docs/img/sct-lib-localmaven.png)
### 1.5 fraudfront æ˜¯å‰ç«¯åº”ç”¨
è¯¥å‰ç«¯åº”ç”¨åŸºäº **Vue 3 + Vite** æ„å»ºã€‚ä½ å¯ä»¥å‚è€ƒé¡¹ç›®ç›®å½•ä¸‹çš„ [`fraudfront/README.md`](fraudfront/README.md) è¿›è¡Œæœ¬åœ°ç¼–è¯‘ä¸å¯åŠ¨ã€‚
```bash
npm install
npm run dev   # é»˜è®¤å¯åŠ¨åœ°å€ï¼šhttp://localhost:5173
npm run build # æ„å»ºç”Ÿäº§ç¯å¢ƒ
```

### 1.6 sql æ–‡ä»¶å¤¹
åŒ…å« [`sql/create-schema.sql`](sql/create_schema.sql)ï¼Œç”¨äºåˆå§‹åŒ–æ•°æ®åº“ã€‚
![img.png](docs/img/sql-schema.png)

### 1.7 åº”ç”¨æ¨¡å—ç»“æ„
æ¨¡å—åˆ’åˆ†å¦‚ä¸‹ï¼š

- `fraud-api`ã€`fraud-starter`: æä¾›å†…éƒ¨æœåŠ¡è°ƒç”¨å’Œ REST å¯åŠ¨æ¥å£ã€‚
- `fraud-biz`: æ ¸å¿ƒé€»è¾‘ï¼ŒåŒ…æ‹¬ `service`ã€`cache` å±‚ç­‰ã€‚
- `fraud-commons`: é€šç”¨æ¨¡å—ï¼ŒåŒ…æ‹¬å·¥å…·ç±»ã€æšä¸¾ã€é”™è¯¯ç ã€å¼‚å¸¸å¤„ç†ç­‰ã€‚
- `fraud-repository`: æ•°æ®æŒä¹…å±‚ï¼ŒåŒ…å« `DO`ã€`mapper` æ¥å£ä¸ `mapper.xml`ã€‚
- å¯æ‰©å±•å¤–éƒ¨æ¨¡å—å¦‚ `SAL`ã€`message` ç­‰ã€‚

## 2. æœ¬åœ°è¿è¡Œä¸æ¥å£æµ‹è¯•

ä½¿ç”¨ Spring Boot 3.2ã€Mavenã€MySQL 8ã€Redisã€RocketMQ ç­‰ã€‚

### 2.1 ç¯å¢ƒå‡†å¤‡

- å®‰è£… JDK 21
- MySQL å®‰è£…ï¼š[é˜¿é‡Œäº‘æ–‡æ¡£](https://developer.aliyun.com/article/1039891)
- Redis å®‰è£…ï¼š[å®˜æ–¹æ–‡æ¡£](https://redis.io/docs/latest/operate/oss_and_stack/install/archive/install-redis/)
- RocketMQ å®‰è£…ï¼š[å®˜æ–¹æ–‡æ¡£](https://rocketmq.apache.org/zh/docs/quickStart/01quickstart)

### 2.2 æ‹·è´ä¾èµ–åŒ…è‡³ Maven ä»“åº“

å°† `libs/sct.zip` è§£å‹è‡³ Maven è·¯å¾„ä¸‹ã€‚

### 2.3 ä¿®æ”¹é…ç½®æ–‡ä»¶

ç¼–è¾‘ `application.yaml` ä¸­é…ç½®ï¼š
- MySQL
- Redis
- RocketMQ

### 2.4 å¯åŠ¨å·¥ç¨‹

```bash
mvn clean install -Dmaven.test.skip=true
```
ä¹Ÿå¯ä»¥ideaå¯åŠ¨å¦‚ä¸‹æ‰€ç¤ºï¼š
![img.png](docs/img/idea-local-profile.png)
ç¡®è®¤æ— è¯¯åè¿è¡Œå·¥ç¨‹ã€‚æ­£å¸¸å¯åŠ¨ç»“æœå¦‚ä¸‹ï¼š
![img.png](docs/img/local-start-success.png)
### 2.5 æ¥å£æµ‹è¯•ï¼ˆPostmanï¼‰

æ¥å£æ–‡æ¡£è§ï¼š`docs/fraud-local.postman_collection.json`

**æµ‹è¯•ç‚¹ï¼š**
- æ£€æŸ¥è§„åˆ™åˆ›å»ºä¸ä¿®æ”¹
- é»‘åå•æ¥å£
- äº¤æ˜“æ¬ºè¯ˆæ£€æµ‹æ¥å£ï¼ˆ/fraud/tx/evaluateï¼‰

## 3. ä»£ç è¯´æ˜

### 3.1 æ¥å£ç»Ÿä¸€è¿”å›å°è£…

- `Object` è¿”å›ï¼Œç»Ÿä¸€æ ¼å¼ã€‚
- é”™è¯¯ç æ ¼å¼åŒ…æ‹¬ `code`ã€`debugInfo`ã€`alertMessage`ã€‚

![img.png](docs/img/ff-result-bound-1.png)
![img_1.png](docs/img/ff-result-bound-2.png)

### 3.2 å¼‚å¸¸ç»Ÿä¸€å¤„ç†

å°è£… `BusinessException`ï¼Œé…åˆé”™è¯¯ç æ ‡å‡†ï¼Œæ”¯æŒè°ƒè¯•ä¸ç”¨æˆ·æç¤ºã€‚

### 3.3 é…ç½®æ–‡ä»¶è¯´æ˜

- `application.yaml`: é»˜è®¤æœ¬åœ°å¼€å‘é…ç½®
- `application-local.yaml`: å¯ç”¨æœ¬åœ°ç¼–è¯‘æµ‹è¯•
- `application-dev.yaml`: k8s å¼€å‘ç¯å¢ƒ
- `application-k8sall.yaml`: MySQL/Redis/RMQ åœ¨åŒä¸€é›†ç¾¤
- `application-k8sone.yaml`: ä¸æ•°æ®åº“/ç¼“å­˜åˆ†ç¦»éƒ¨ç½²
![img.png](docs/img/local-profile-setting.png)

## 4. å‰ç«¯å·¥ç¨‹æœ¬åœ°å¯åŠ¨

åœ¨ `fraudfront` ç›®å½•ä¸‹æ‰§è¡Œï¼š

```bash
npm install
npm run dev
```

é»˜è®¤è®¿é—®åœ°å€ï¼šhttp://localhost:5173

æ„å»ºç”Ÿäº§ç¯å¢ƒï¼š

```bash
npm run build
```

